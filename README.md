# yourCodeReview

Ссылка с описанием задания:
https://github.com/avito-tech/geo-backend-trainee-assignment

Стэк: Spring Boot, java 11

Реализовал:
- хранилище строк, списков, словарей.
- операторы: GET, SET, DEL, KEYS.
- операторы: HGET, HSET, LGET, LSET.
- TTL на каждый ключ.
- Unit тесты на контролеры и сервисы.

По маршруты resources/postman можно будет найти примеры JSON для каждого контроллера с возможными варианты ответов.
Примечание: в проекте используются только Post запросы.

Описание решения:
Проект разбит на слои: controllers, repositories, services, models.

#models:
Содержит классы, которые описывают хранимые сущности и ключи к ним.
За описание ключа отвечает класс Key.
Содержит следующие поля:
- key. Значение ключа, по которому хранится StoredEntity.
- hasExpirationTime. Установлен флаг, для хранения по таймеру.
- delayTime. Время, когда ключ будет удален.

За описание хранимых сущностей отвечает интерфейс StoredEntity.
Имеет два абстрактных метода: getValue, setValue.
Данный интерфейс реализуют три класса:
- ListEntity, отвечает за хранение списков.
- SetEntity, отвечает за хранение словарей.
- StringEntity, отвечает за хранение строк.

#repositories:

Хранит один класс CacheRepository.
Выполняет роль хранилища сущностей, в оперативной памяти.
Само хранилище представляет собой ConcurrentHashMap cache.
Класс содержит методы, которые необходимы для сохранения, получения, удаление Key и StoredEntity.
ConcurrentHashMap был выбран, т.к команда expire создает экземпляр класса Timer,
который исполняет метод run() интерфейса Runnable.
Что бы избежать полное блокирование cache, был выбран ConcurrentHashMap.
Сам cache хранится по мягкой ссылке, для избежания outOfMemmory.

#services:
Пакет хранит сервисы.
Каждый сервис связан с CacheRepository.
Сервисы:
- ExpireService. Содержит методы, для expire и ttl логики.
- KeysService. Содержит методы, для работы с ключами.
- ListService. Содержит методы, для работы со списками.
- SetService. Содержит методы, для работы со словарями.
- SingleStringService. Содержит методы, для работы со строками.

#controllers.
Пакет хранит контроллеры.

ExpireController методы:
- ttl. Проверяет сколько времени осталось у ключа, до удаления.
- expire. Устанавливает время, через сколько ключ будет удален.

KeysController методы:
- del. Метод удаляет указанные ключи.
- keys. Метод возвращает ключи, по указанному паттерну.

SetValuesController методы:
- hset. Метод, который создает представление Key, SetEntity или добавляет уже в существующий.
- hget. Метод, возвращает значение по ключу сущности и по ключи хранимого списка.

StringValuesController методы:
- get. Метод, возвращает строковое значение, по указанному ключу.
- set. Метод, создает представление Key, StringEntity.

ListValuesController методы:
- lpush. Метод, который создает новое представление Key, ListEntity или добавляет элементы "с слева" уже в существующие.
- lset. Метод, который заменяет элемент в существующем списке на новый по индексу.
- lget. Метод, который возвращает элементы из списка, по startIndex и finishIndex. Принимает отрицательные значения.
- lindex. Метод, который возвращает элемент списка по индексу. Не принимает отрицательные значения.
- llen. Метод, который возвращает длину хранимого списка.

# dto
Пакет хранит классы dto, используемые в контролерах. Для валидации используется HibernateValidator.

#utils
Вспомогательные классы.
Consts - константы.
ResponseGenerator - класс, который генерирует ResponseEntity.